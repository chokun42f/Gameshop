<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile | Game Shop</title>
    <link rel="stylesheet" href="./css/user_style.css" />
</head>

<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="navbar-left">
            <img src="./image/logo1.png" alt="logo" class="logo" />
            <h1>Game Shop</h1>
        </div>

        <div class="navbar-right">
            <a href="/admin_main">Store</a>
            <a href="/library">Library</a>
            <a href="/admin_profile" id="username">User</a>
            <div class="user-info">
                <img id="profile-pic" src="./image/user.png" alt="Profile Picture" />
            </div>
        </div>
    </div>

    <!-- Profile Card -->
    <div class="profile-container">
        <div class="profile-card">

            <h2>Profile</h2>
            <img id="profile-img-large" class="profile-pic" src="./image/user.png" alt="Profile Picture" />
            <div class="info"><strong>Name:</strong> <span id="name">User</span></div>
            <div class="info"><strong>Email:</strong> <span id="email">user@example.com</span></div>

            <div class="card-buttons">
                <button id="manageUsersBtn" class="amount-btn">Manage Users</button>
                <button id="logoutBtn" class="logout-btn">Logout</button>
            </div>
        </div>
    </div>

    <!-- Script -->
     <script src="./js/navbar.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", async () => {
            try {
                // เช็ค session
                const res = await fetch("/check-session", {
                    method: "GET",
                    credentials: "include"
                });
                const data = await res.json();

                if (!data.loggedIn) {
                    // ไม่ login → กลับหน้า login
                    window.location.href = "/";
                    return;
                }

                // แสดงข้อมูลผู้ใช้
                document.getElementById("username").textContent = data.user.name || "User";
                document.getElementById("name").textContent = data.user.name || "User";
                document.getElementById("email").textContent = data.user.email || "";

                const profilePath = data.user.profile && data.user.profile !== ""
                    ? data.user.profile
                    : "./image/user.png"; // รูป default

                document.getElementById("profile-pic").src = profilePath;
                document.getElementById("profile-img-large").src = profilePath;


                // Logout
                document.getElementById("logoutBtn").addEventListener("click", async () => {
                    await fetch("/logout", {
                        method: "POST", // server รับ POST
                        credentials: "include"
                    });
                    localStorage.removeItem("lastPage"); // ล้าง lastPage
                    window.location.href = "/"; // กลับหน้า login
                });

            } catch (err) {
                console.error("Error fetching user info:", err);
            }
        });
    </script>

</body>

</html>